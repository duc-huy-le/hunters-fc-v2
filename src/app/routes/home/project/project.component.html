<div class="project_container p-4">
  <div class="action_btns pb-3">
    <div nz-row nzGutter="16">
      <div nz-col [nzSpan]="6">
        <nz-input-group [nzSuffix]="suffixIconSearch">
          <input
            type="text"
            nz-input
            placeholder="Tìm kiếm id dự án của bạn, tên dự án..."
            [ngModel]="searchProjectValue"
            (ngModelChange)="onSearchProject($event)"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
      </div>
      <div nz-col [nzSpan]="18" class="flex justify-end">
        <button
          nz-button
          nzType="primary"
          class="mr-2"
          (click)="openAddProjectModal()"
        >
          <i class="fas fa-plus-circle mr-2"></i>Thêm dự án mới
        </button>
        <button nz-button nzType="default" (click)="reloadData()">
          <i class="fas fa-redo-alt"></i>
        </button>
      </div>
    </div>
    <!-- <nz-select
      [(ngModel)]="listOfTagOptions"
      nzMode="tags"
      [nzTokenSeparators]="[',']"
      nzPlaceHolder="The search feature is currently being developed"
      (ngModelChange)="betaMessage($event)"
    >

    </nz-select> -->
  </div>
  <nz-table
    #basicTable
    [nzLoading]="loadingTable"
    [nzScroll]="{ y: 'calc(100vh - 250px)' }"
    [nzData]="listViewProject"
  >
    <thead>
      <tr>
        <th nzWidth="10%">Mã dự án</th>
        <th nzWidth="20%">Tên dự án</th>
        <th nzWidth="20%">Loại dự án</th>
        <!-- <th>Link tracking</th>
        <th nzWidth="15%">Number of clicks</th> -->
        <th nzWidth="15%">Ngày tạo</th>
        <th nzWidth="10%">Hành động</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let data of basicTable.data; let i = index"
        (contextmenu)="contextMenu($event, projectContextMenu, data)"
      >
        <td>{{ data?.id }}</td>
        <td>{{ data?.name }}</td>
        <td>
          <span [ngSwitch]="data?.type_id">
            <span *ngFor="let availableProjectType of availableProjectTypeList">
              <nz-tag
                class="m-0 py-1 px-3 text-[14px] font-bold rounded-[10px]"
                *ngSwitchCase="availableProjectType?.id"
                [nzColor]="availableProjectType?.color"
                >{{ availableProjectType?.name }}</nz-tag
              >
            </span>
          </span>
        </td>
        <!-- <td nzEllipsis>
          <a target="_blank" href="{{ data.link_tracking }}">{{
            data.link_tracking
          }}</a>
        </td>
        <td nzAlign="center">{{ data.number_of_clicks | number }}</td> -->
        <td>{{ data.created_at | date : "dd/MM/yyyy" }}</td>
        <td>
          <!-- <button
            nz-button
            nz-tooltip
            nzTooltipTitle="Copy to clipboard"
            nzType="default"
            nzShape="circle"
            class="mr-2"
            (click)="copyToClipboard(data.link_tracking)"
          >
            <i class="far fa-copy"></i>
          </button> -->
          <!-- <button
            nz-button
            nz-tooltip
            nzTooltipTitle="View click statistics"
            nzType="default"
            nzShape="circle"
            class="mr-2"
            (click)="onClickProject(data)"
          >
            <i class="fas fa-chart-line"></i>
          </button> -->
          <button
            nz-button
            nz-tooltip
            nzTooltipTitle="Xem chi tiết dự án"
            nzType="default"
            nzShape="circle"
            class="mr-2"
            (click)="viewDetailProject(data)"
          >
            <i class="fas fa-info-circle"></i>
          </button>
          <!-- <button
            nz-button
            nz-tooltip
            nzTooltipTitle="View campaign list"
            nzType="default"
            nzShape="circle"
            class="mr-2"
            (click)="viewCampaignList(data)"
          >
            <i class="fas fa-window-restore"></i>
          </button> -->
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>

<nz-modal
  [(nzVisible)]="isVisible"
  [nzTitle]="projectModalTitle"
  nzWidth="90vw"
  (nzOnCancel)="closeModal()"
  (nzOnOk)="handleAddProject()"
  [nzOkText]="getNzOkText()"
  [nzBodyStyle]="modalBodyStyle"
  [nzMaskClosable]="false"
>
  <ng-container *nzModalContent>
    <div *ngIf="addProjectStep === 1 && projectModalMode === ProjectModalMode.ADD" nz-row nzGutter="16" class="my-3">
      <div nz-col nzSpan="12">
        <div
          class="project_type_block flex flex-col justify-center items-center"
          (click)="onClickProjectType('1')"
        >
          <div>
            <img
              class="h-[400px]"
              src="https://i.postimg.cc/65LqNtGL/Tracking.png"
              alt="Thống kê click"
            />
          </div>
          <div class="font-bold text-[var(--primaryColor)] text-[28px] mb-3">
            Thống kê click
          </div>
          <div class="project_type_cost">
            Chi phí: <b>1%</b> chi tiêu của chiến dịch
          </div>
          <div class="py-3">
            Nhận dữ liệu thống kê của mỗi click trong chiến dịch ads của bạn
          </div>
        </div>
      </div>
      <div nz-col nzSpan="12">
        <div
          class="project_type_block flex flex-col justify-center items-center"
          [ngClass]="isTrialMode ? 'project_type_block__disable' : ''"
          (click)="onClickProjectType('3')"
        >
          <div>
            <img
              class="h-[400px]"
              src="https://i.postimg.cc/Vst5Djfh/Redirect.png"
              alt="Bọc link và chuyển hướng"
            />
          </div>
          <div class="font-bold text-[var(--primaryColor)] text-[28px] mb-3">
            Bọc link và chuyển hướng
          </div>
          <div class="project_type_cost">
            Chi phí: <b>20%</b> chi tiêu của chiến dịch
          </div>
          <div class="py-3">
            Bảo vệ tài khoản affiliate với vũ khí bọc link và chuyển hướng có
            điều kiện
          </div>
          <!-- <span class="project_type_ribbon">RECOMMENDED</span> -->
          <span class="ribbon-2">RECOMMENDED</span>
        </div>
      </div>
    </div>
    <div *ngIf="addProjectStep === 2 || projectModalMode !== ProjectModalMode.ADD" nz-row>
      <div nz-col nzSpan="24">
        <form
          nz-form
          [formGroup]="projectForm"
          [nzLayout]="'vertical'"
          class="login-form"
        >
          <div class="mt-4" nz-row nzGutter="16">
            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="projectName"
                  >Tên dự án:</nz-form-label
                >
                <nz-form-control nzErrorTip="Vui lòng nhập tên dự án!">
                  <nz-input-group nzPrefixIcon="book">
                    <input
                      id="projectName"
                      nz-input
                      formControlName="name"
                      placeholder="Nhập tên dự án"
                      value=" "
                    />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
            <!-- <div nz-col nzSpan="6">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="projectName"
                  >Loại dự án:</nz-form-label
                >
                <nz-form-control nzErrorTip="Vui lòng chọn loại dự án!">
                  <div class="flex">
                    <nz-select
                      class="passenger-input"
                      [nzAllowClear]="false"
                      id="type_id"
                      nzPlaceHolder="Chọn loại dự án"
                      nzShowSearch
                      formControlName="type_id"
                    >
                      <nz-option
                        *ngFor="let projectType of projectTypeList"
                        [nzValue]="projectType?.id!"
                        [nzLabel]="projectType?.name!"
                      ></nz-option>
                    </nz-select>
                  </div>
                </nz-form-control>
              </nz-form-item>
            </div> -->
            <div nz-col nzSpan="12">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="active"
                  >Đang hoạt động:</nz-form-label
                >
                <nz-form-control>
                  <nz-switch id="active" formControlName="active"></nz-switch>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
          <!-- <div nz-row nzGutter="16">
            <div nz-col nzSpan="24">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="failurePage"
                  >Failure page:</nz-form-label
                >
                <nz-form-control nzErrorTip="Please enter failure page!">
                  <nz-input-group nzPrefixIcon="book">
                    <input
                      nz-input
                      id="failurePage"
                      placeholder="Input failure page"
                      value=" "
                      formControlName="url"
                    />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div> -->
          <nz-form-label nzRequired>Link ref:</nz-form-label>
          <div nz-row nzGutter="16">
            <nz-table
              [nzFooter]="refTableFooter"
              nzBordered
              [nzData]="refs.value"
              [nzFrontPagination]="false"
              [nzShowPagination]="false"
              nzTableLayout="fixed"
              class="mt-3"
            >
              <thead>
                <tr>
                  <th nzAlign="center" nzWidth="100px">Số thứ tự</th>
                  <!-- <th nzAlign="center" nzWidth="60px"></th> -->
                  <th nzAlign="left" nzWidth="auto">Tên ref</th>
                  <th nzAlign="left" nzWidth="10%">Mã ref</th>
                  <th nzAlign="center" nzWidth="30%">Link ref</th>
                  <th nzAlign="center" nzWidth="8%">Xác suất</th>
                  <th nzAlign="center" nzWidth="8%">Điều kiện</th>
                  <th nzAlign="center" nzWidth="8%">Hoạt động</th>
                  <th nzAlign="center" nzWidth="8%">Hành động</th>
                </tr>
              </thead>
              <tbody formArrayName="refs">
                <ng-container
                  *ngFor="let data of refs.controls; let i = index"
                  [formGroupName]="i"
                >
                  <tr>
                    <td nzAlign="center">
                      {{ i + 1 }}
                    </td>
                    <!-- <td
                      [nzExpand]="expandSet.has(i)"
                      (nzExpandChange)="onExpandChange(i, $event)"
                    ></td> -->
                    <td>
                      <nz-form-item>
                        <nz-form-control nzErrorTip="Vui lòng chọn ref!">
                          <div class="flex">
                            <nz-select
                              class="passenger-input"
                              [nzAllowClear]="false"
                              id="ref"
                              nzPlaceHolder="Lựa chọn ref"
                              nzShowSearch
                              formControlName="refId"
                              (ngModelChange)="onSelectRef($event, i)"
                            >
                              <nz-option
                                *ngFor="let ref of availableRefList"
                                [nzValue]="ref?.id!"
                                [nzLabel]="ref?.name!"
                              ></nz-option>
                            </nz-select>
                          </div>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td>
                      <nz-form-item>
                        <nz-form-control>
                          <nz-input-group>
                            <input
                              nz-input
                              id="refIdView"
                              placeholder="Lựa chọn tên ref"
                              value=" "
                              formControlName="refIdView"
                            />
                          </nz-input-group>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td>
                      <nz-form-item>
                        <nz-form-control>
                          <nz-input-group>
                            <input
                              nz-input
                              id="refLink"
                              placeholder="Lựa chọn link ref"
                              value=" "
                              formControlName="refLink"
                            />
                          </nz-input-group>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td>
                      <nz-form-item>
                        <nz-form-control>
                          <nz-input-group>
                            <nz-input-number
                              class="w-full"
                              [nzMin]="0"
                              [nzMax]="100"
                              [nzStep]="1"
                              [nzFormatter]="formatterPercent"
                              [nzParser]="parserPercent"
                              formControlName="probability"
                            ></nz-input-number>
                          </nz-input-group>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td nzAlign="center">
                      <nz-form-item>
                        <nz-form-control>
                          <nz-input-group>
                            <nz-switch
                              [nzDisabled]="!refs.controls[i].value.refId"
                              [ngClass]="{ 'ant-switch-disabled': isTrialMode }"
                              formControlName="isUseConditions"
                              (ngModelChange)="onExpandChange(i, $event)"
                            ></nz-switch>
                          </nz-input-group>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td nzAlign="center">
                      <nz-form-item>
                        <nz-form-control>
                          <nz-input-group>
                            <nz-switch
                              formControlName="active"
                              (ngModelChange)="onChangeRefActive(i, $event)"
                            ></nz-switch>
                          </nz-input-group>
                        </nz-form-control>
                      </nz-form-item>
                    </td>
                    <td nzAlign="center">
                      <button
                        nz-button
                        nzDanger
                        nzType="primary"
                        [disabled]="projectModalMode === ProjectModalMode.VIEW"
                        class="mr-2"
                        (click)="onClickDeleteRowRefsForm(i)"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <tr [nzExpand]="expandSet.has(i)">
                    <span *ngIf="redirectProfileModel[i]">
                      <div class="px-24">
                        <div nz-row nzGutter="16">
                          <div nz-col nzSpan="24">
                            <div class="font-bold text-[16px]">
                              Điều kiện chuyển hướng tham chiếu:
                            </div>
                          </div>
                          <nz-divider></nz-divider>
                          <!-- Đoạn này comment lại vì giờ chưa cần cho user nhập tên profile cho đỡ phức tạp -->
                          <!-- <div nz-col nzSpan="12">
                              <input
                                id="profileName"
                                nz-input
                                placeholder="Input profile name"
                                value=" "
                                [(ngModel)]="
                                  redirectProfile['RedirectProfileName']
                                "
                                [ngModelOptions]="{ standalone: true }"
                              />
                            </div> -->
                          <div nz-col nzSpan="6">
                            <div class="condition_title">
                              Hoạt động áp dụng giữa các điều kiện
                            </div>
                            <nz-radio-group
                              id="profileOperator"
                              [nzDisabled]="
                                projectModalMode === ProjectModalMode.VIEW
                              "
                              [(ngModel)]="
                                redirectProfileModel[i]['ProfileOperator']
                              "
                              [ngModelOptions]="{ standalone: true }"
                            >
                              <label
                                *ngFor="let item of profileOperatorList"
                                nz-radio
                                [nzValue]="item?.value"
                                >{{ item?.label }}</label
                              >
                            </nz-radio-group>
                            <div
                              *ngIf="
                                isShowConditionErrorTip &&
                                redirectProfileModel[i]['ProfileOperator'] == ''
                              "
                              class="ant-form-item-explain-error"
                            >
                              Vui lòng lựa hành động chuyển hướng
                            </div>
                          </div>
                          <!-- <div nz-col nzSpan="6">
                            <div class="condition_title">Active</div>
                            <nz-switch
                              [(ngModel)]="redirectProfileModel[i]['Active']"
                              [ngModelOptions]="{ standalone: true }"
                            ></nz-switch>
                          </div> -->
                        </div>
                        <div nz-row nzGutter="16" class="mt-3">
                          <div nz-col nzSpan="24">
                            <h3 class="condition_title">
                              Điều kiện chuyển hướng chi tiết
                            </h3>
                          </div>
                        </div>
                        <div
                          *ngFor="
                            let redirectCondition of redirectProfileModel[i][
                              'RedirectConditions'
                            ];
                            let j = index
                          "
                          nz-row
                          nzGutter="16"
                          class="my-2"
                        >
                          <div nz-col nzSpan="6">
                            <nz-select
                              class="passenger-input"
                              [nzAllowClear]="false"
                              nzShowSearch
                              id="redirectType"
                              [nzDisabled]="
                                projectModalMode === ProjectModalMode.VIEW
                              "
                              nzPlaceHolder="Lựa chọn kiểu tham chiếu"
                              [nzStatus]="
                                !isShowConditionErrorTip ||
                                redirectCondition['RedirectTypeID']
                                  ? ''
                                  : 'error'
                              "
                              [(ngModel)]="redirectCondition['RedirectTypeID']"
                              [ngModelOptions]="{
                                standalone: true
                              }"
                              (ngModelChange)="onChangeRedirectType($event)"
                            >
                              <nz-option
                                *ngFor="let redirectType of redirectTypeList"
                                [nzValue]="redirectType?.value!"
                                [nzLabel]="redirectType?.label!"
                              ></nz-option>
                            </nz-select>
                            <div
                              *ngIf="
                                isShowConditionErrorTip &&
                                !redirectCondition['RedirectTypeID']
                              "
                              class="ant-form-item-explain-error"
                            >
                              Vui lòng lựa chọn ref mục tiêu!
                            </div>
                          </div>
                          <div nz-col nzSpan="6">
                            <nz-select
                              class="passenger-input"
                              [nzAllowClear]="false"
                              nzShowSearch
                              id="redirectOperator"
                              [nzDisabled]="
                                projectModalMode === ProjectModalMode.VIEW
                              "
                              [nzStatus]="
                                !isShowConditionErrorTip ||
                                redirectCondition['RedirectOperatorID']
                                  ? ''
                                  : 'error'
                              "
                              nzPlaceHolder="Lựa chọn hành động tham chiếu"
                              [(ngModel)]="
                                redirectCondition['RedirectOperatorID']
                              "
                              [ngModelOptions]="{
                                standalone: true
                              }"
                            >
                              <nz-option
                                *ngFor="
                                  let redirectOperator of selectableRedirectOperatorList
                                "
                                [nzValue]="redirectOperator?.value!"
                                [nzLabel]="redirectOperator?.label!"
                              ></nz-option>
                            </nz-select>
                            <div
                              *ngIf="
                                isShowConditionErrorTip &&
                                !redirectCondition['RedirectOperatorID']
                              "
                              class="ant-form-item-explain-error"
                            >
                              Vui lòng lựa hành động tham chiếu!
                            </div>
                          </div>
                          <div nz-col nzSpan="6">
                            <nz-input-group>
                              <input
                                id="ValueCondition"
                                nz-input
                                [disabled]="
                                  projectModalMode === ProjectModalMode.VIEW
                                "
                                [nzStatus]="
                                  !isShowConditionErrorTip ||
                                  redirectCondition['ValueCondition']
                                    ? ''
                                    : 'error'
                                "
                                placeholder="Nhập giá trị điều kiện"
                                value=" "
                                [(ngModel)]="
                                  redirectCondition['ValueCondition']
                                "
                                [ngModelOptions]="{
                                  standalone: true
                                }"
                              />
                            </nz-input-group>
                            <div
                              *ngIf="
                                isShowConditionErrorTip &&
                                !redirectCondition['ValueCondition']
                              "
                              class="ant-form-item-explain-error"
                            >
                              Vui lòng nhập giá trị điều kiện!
                            </div>
                          </div>
                          <div nz-col nzSpan="6">
                            <button
                              *ngIf="projectModalMode !== ProjectModalMode.VIEW"
                              nz-button
                              nzDanger
                              nzType="dashed"
                              nzShape="circle"
                              class="mr-2"
                              (click)="onClickDeleteRowRedirectConditions(i, j)"
                            >
                              <i class="fas fa-minus"></i>
                            </button>
                          </div>
                        </div>
                        <div
                          *ngIf="projectModalMode !== ProjectModalMode.VIEW"
                          nz-row
                          nzGutter="16"
                        >
                          <div nz-col nzSpan="24">
                            <button
                              nz-button
                              nzType="dashed"
                              class=""
                              (click)="addMoreConditionRow(i)"
                            >
                              <i class="fas fa-plus-circle"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </span>
                  </tr>
                </ng-container>
              </tbody>
            </nz-table>
            <ng-template #refTableFooter>
              <div
                *ngIf="projectModalMode !== ProjectModalMode.VIEW"
                nz-row
                class="px-2 py-2"
              >
                <div nz-col nzSpan="12">
                  <button
                    nz-button
                    nzType="primary"
                    class="mr-2"
                    [ngClass]="{
                      'disable_trial_button': isTrialMode
                    }"
                    (click)="addMoreRefRow()"
                  >
                    <i class="fas fa-plus-circle mr-2"></i>Thêm link ref
                  </button>
                </div>
                <div nz-col nzSpan="12">
                  <button
                    nz-button
                    class="float-right"
                    nzType="default"
                    (click)="autoAllocateRefPercent()"
                  >
                    <i class="fas fa-random mr-2"></i>Tự động phân bổ tỷ lệ link
                    ref
                  </button>
                </div>
              </div>
            </ng-template>
          </div>
          <ng-container *ngIf="projectModalMode !== ProjectModalMode.ADD">
            <nz-form-label class="mt-5" nzRequired>Campaigns:</nz-form-label>
            <div nz-row>
              <div nz-col nzSpan="12">
                <button
                  *ngIf="!isAddingCampaign"
                  nz-button
                  nzType="primary"
                  class="mb-3"
                  (click)="onClickAddCampaign()"
                >
                  <i class="fas fa-plus-circle mr-2"></i>Thêm chiến dịch mới
                </button>
                <button
                  *ngIf="isAddingCampaign"
                  nz-button
                  nzType="default"
                  class="mb-3"
                  (click)="onCancelAddCampaign()"
                >
                  <i class="fas fa-times mr-2"></i>Hủy
                </button>
              </div>
              <div nz-col nzSpan="12"></div>
            </div>
            <nz-table
              #campaignListTable
              [nzData]="campaignList"
              [nzScroll]="{ x: '100%' }"
            >
              <thead>
                <tr>
                  <th nzWidth="12%">Tên chiến dịch</th>
                  <th nzWidth="12%">Mã chiến dịch</th>
                  <th nzWidth="10%">Ngày tạo</th>
                  <th nzWidth="auto">Kịch bản</th>
                </tr>
                <tr *ngIf="isAddingCampaign">
                  <th>
                    <input
                      nz-input
                      placeholder="Nhập tên chiến dịch quảng cáo"
                      [(ngModel)]="adsCampaignNameInput"
                      [ngModelOptions]="{
                        standalone: true
                      }"
                      [nzStatus]="adsCampaignNameInputStatus"
                    />
                  </th>
                  <th>
                    <input
                      nz-input
                      placeholder="Nhập mã chiến dịch quảng cáo"
                      [(ngModel)]="adsCampaignIdInput"
                      [ngModelOptions]="{
                        standalone: true
                      }"
                      [nzStatus]="adsCampaignIdInputStatus"
                    />
                  </th>
                  <th></th>
                  <th>
                    <button
                      nz-button
                      nzType="primary"
                      nzShape="circle"
                      [nzLoading]="isLoadingSaveCampaignButton"
                      (click)="onSaveCampaign()"
                    >
                      <i class="fas fa-check"></i>
                    </button>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of campaignListTable.data">
                  <td>{{ data?.name }}</td>
                  <td>{{ data?.id }}</td>
                  <td>{{ data?.created_at | date : "dd/MM/yyyy" }}</td>
                  <td>
                    <div class="script_box relative">
                      <div class="absolute top-[4px] right-0">
                        <button
                          nz-button
                          nzType="default"
                          nzShape="circle"
                          (click)="copyToClipboard(data?.script!)"
                        >
                          <i class="fas fa-copy"></i>
                        </button>
                      </div>
                      {{ data?.script }}
                    </div>
                  </td>
                </tr>
              </tbody>
            </nz-table>
          </ng-container>
          <!-- <nz-form-item>
            <nz-form-label nzRequired nzFor="ref"
              >Ref:</nz-form-label
            >
            <nz-form-control nzErrorTip="Please select ref!">
              <nz-select id="ref" nzPlaceHolder="Select ref" formControlName="refs">
                <nz-option *ngFor="let ref of refList" [nzValue]="ref?.id!" [nzLabel]="ref?.name!"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item> -->
          <!-- <form nz-form [formGroup]="refForm" [nzLayout]="'vertical'">
            @for (control of listOfControl; track control; let i = $index) {
            <nz-form-item>
              @if (i === 0) {
              <nz-form-label
                [nzXs]="24"
                [nzSm]="4"
                [nzFor]="control.controlInstance"
                nzRequired
              >
                Ref:
              </nz-form-label>
              }
              <nz-form-control nzErrorTip="Please select a ref!">
                <div class="flex">
                  <nz-select
                    class="passenger-input"
                    [nzAllowClear]="true"
                    [attr.id]="control.id"
                    [formControlName]="control.controlInstance"
                    id="ref"
                    nzShowSearch
                    nzPlaceHolder="Select ref"
                    (ngModelChange)="onSelectRef($event)"
                  >
                    <nz-option
                      *ngFor="let ref of availableRefList"
                      [nzValue]="ref?.id!"
                      [nzLabel]="ref?.name!"
                    ></nz-option>
                  </nz-select>
                  @if (listOfControl.length > 1) {
                  <button
                    nz-button
                    nzType="default"
                    nzShape="circle"
                    class="ml-3"
                    (click)="removeField(control, $event)"
                  >
                    <i class="fas fa-minus"></i></button
                  >}
                </div>
              </nz-form-control>
            </nz-form-item>
            }
            <nz-form-item>
              <nz-form-control>
                <button
                  disabled
                  nz-button
                  nzType="dashed"
                  class="add-button"
                  nz-tooltip
                  nzTooltipTitle="Tính năng đang trong giai đoạn phát triển"
                  nzTooltipPlacement="bottomLeft"
                  (click)="addField($event)"
                >
                  <span nz-icon nzType="plus"></span>
                  Add more refs
                </button>
              </nz-form-control>
            </nz-form-item>
          </form> -->
        </form>
      </div>
    </div>
  </ng-container>
  <div *nzModalFooter>
    <button nz-button nzType="default" (click)="handleCancel()">
      {{ projectModalMode === ProjectModalMode.VIEW ? "Đóng" : "Hủy" }}
    </button>
    <button *ngIf="addProjectStep !== 1" nz-button nzType="primary" (click)="handleAddProject()">
      {{
        projectModalMode === ProjectModalMode.VIEW
          ? "Sửa dự án"
          : projectModalMode === ProjectModalMode.EDIT
          ? "Lưu dự án"
          : "Thêm dự án"
      }}
    </button>
  </div>
  <ng-template #projectModalTitle>
    {{
      projectModalMode === ProjectModalMode.VIEW
        ? selectingProject!.name + " (" + selectingProject!.id + ")"
        : projectModalMode === ProjectModalMode.EDIT
        ? "Edit " + selectingProject!.name + " (" + selectingProject!.id + ")"
        : "Thêm dự án mới"
    }}
    <span [ngSwitch]="projectForm.getRawValue()?.type_id" class="ml-4">
      <span *ngFor="let availableProjectType of availableProjectTypeList">
        <nz-tag
          class="m-0 py-1 px-3 text-[14px] font-bold rounded-[10px]"
          *ngSwitchCase="availableProjectType?.id"
          [nzColor]="availableProjectType?.color"
          >{{ availableProjectType?.name }}</nz-tag
        >
      </span>
    </span>
  </ng-template>
</nz-modal>
<app-campaign-click-statistics-modal
  #projectClickStatisticsModal
></app-campaign-click-statistics-modal>

<app-campaign-list-modal #appCampaignListModal></app-campaign-list-modal>
<nz-dropdown-menu #projectContextMenu="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item class="min-w-52 py-3" (click)="viewDetailProject()">
      <i class="fas fa-info-circle mr-2"></i>Xem chi tiết
    </li>
    <li nz-menu-item class="min-w-52 py-3" (click)="editProject()">
      <i class="fas fa-pen mr-2"></i>Chỉnh sửa
    </li>
    <!-- <li nz-menu-item class="py-3" (click)="viewCampaignList()">
      <i class="fas fa-window-restore mr-2"></i>View Campaign List
    </li> -->
  </ul>
</nz-dropdown-menu>
